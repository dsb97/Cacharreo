<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monitor del sistema</title>
    <link href="https://fonts.googleapis.com/css2?family=Varela+Round&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/window.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.9.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="./sidebars.css">
    <style id="dynamicStyle"></style>
    <script>
        var windowID = new URLSearchParams(window.location.search).get('id');
    </script>
</head>

<body>
    <div class="row h-100">
        <div class="col-12 h-100">
            <div class="defaultWindowColor scrollable overflow-auto rounded">
                <ul class="list-unstyled ps-0">
                    <ul class="list-unstyled ps-0">
                        <li class="mb-1">
                            <button class="btn btn-toggle align-items-center rounded collapsed defaultFontColor"
                                data-bs-toggle="collapse" data-bs-target="#activities-collapse" aria-expanded="false">
                                <i class="bi bi-window-stack mx-2"></i>
                                Procesos:<span id="processesCount"></span>
                            </button>
                            <div class="collapse" id="activities-collapse">

                            </div>
                        </li>

                        <li class="mb-1">
                            <button class="btn btn-toggle align-items-center rounded collapsed defaultFontColor"
                                data-bs-toggle="collapse" data-bs-target="#CPUMemory-collapse" aria-expanded="true">
                                <i class="bi bi-activity mx-2"></i>
                                Actividad
                            </button>
                            <div class="collapse show" id="CPUMemory-collapse">
                                <ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small">
                                    <li>
                                        <div class="d-flex justify-content-around">
                                            <p id="processor-number" class="defaultFontColor"></p>
                                            <p id="cpu-usage" class="defaultFontColor"></p>
                                            <p id="memory-usage" class="defaultFontColor"></p>
                                        </div>
                                        <div class="d-flex justify-content-center">
                                            <canvas id="CPUUsage" width="300"></canvas>
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </li>
                    </ul>
                </ul>
            </div>
        </div>
    </div>



    <!-- <script src="js/index.js"></script> -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3"
        crossorigin="anonymous"></script>
    <script type="text/javascript" src="/js/shared.js"></script>
    <script type="text/javascript" src="/windows/sidebars.js"></script>
    <!-- <script type="text/javascript" src="/windows/windows.js"></script> -->
    <script>
        

        window.addEventListener('DOMContentLoaded', function (event) {
            debugger;
            new window.parent.taskManager(windowID);
        });



       /*  function toggleCheckRows(event) {
            let ids = document.querySelectorAll('.checkedApps');

            for (let i = 0; i < ids.length; i++) {
                ids[i].checked = event.target.checked;
            }
        }
        
        function loadCPU() {
            // Get CPU usage and update the CPU usage display
            if (window.performance && window.performance.now) {
                let cpuUsage = window.performance.now();
                document.getElementById("cpu-usage").textContent = `Uso de CPU: ${((cpuUsage - previousCPUValue) / 50).toFixed(2)} %`;
                addData((cpuUsage - previousCPUValue) / 50, 0);
                previousCPUValue = cpuUsage;
            }

            document.getElementById('processor-number').textContent = `Procesadores lÃ³gicos: ${navigator.hardwareConcurrency}`;

            // Get memory usage and update the memory usage display
            if (window.performance && window.performance.memory) {
                let memoryUsage = window.performance.memory.usedJSHeapSize / (1024 * 1024 * 1024);
                document.getElementById("memory-usage").textContent = `Memoria en uso: ${(memoryUsage).toFixed(2)} GB`;
                addData(memoryUsage, 1);
            }
        }

        function loadTasks() {
            let tasks = getCachedWindows();
            processesCount.innerHTML = '&nbsp;' + tasks.length;
            let openApps = [...new Set(tasks.map(item => item.dockIcon))];
            let windows = '';
            let group = `
                <ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small">
                                    <li>
                                        <table class="table table-striped table-hover">
                                            <thead>
                                                <tr>
                                                    <th class="defaultFontColor" scope="col"><input class="form-check-input" type="checkbox" onchange="toggleCheckRows(event)" ></th>
                                                    <th class="defaultFontColor" scope="col">&nbsp</th>
                                                    <th class="defaultFontColor" scope="col">ID proceso</th>
                                                    <th class="defaultFontColor" scope="col">Nombre</th>
                                                    <th class="defaultFontColor" scope="col">Memoria</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                replaceContent
                                            </tbody>
                                        </table>
                                    </li>
                                </ul>
                `;
            let tareas = document.getElementById('activities-collapse');
            tareas.innerHTML = "";
            openApps.forEach((app) => {
                tasks.forEach((x) => {
                    if (x.dockIcon == app) {
                        let systemApp = window.parent.systemApps.content.filter((x) => { if (x.internalName == `${app}.app`) { return x } })[0];
                        windows += `
                        <tr>
                            <th class="defaultFontColor" scope="row"><input class="form-check-input checkedApps" type="checkbox" value="${x.windowID}" ></th>
                            <td class="defaultFontColor"><img src="${systemApp.icon}" style="height: 12pt; width: 12pt;"/></td>
                            <td class="defaultFontColor">${x.windowID}</td>
                            <td class="defaultFontColor">${systemApp.name}</td>
                            <td class="defaultFontColor">${new Blob([JSON.stringify(x.history.urlList)]).size} bytes</td>
                        </tr>
                        `;
                    }
                });
            });
            group = group.replaceAll('replaceContent', windows);
            tareas.innerHTML += group;
        }

        function closeApp(windowID) {
            let cW = getCachedWindow(windowID);
            //Remove from cache
            removeCachedWindow(windowID);

            //Query cache to remove or not dock indicator
            let cWs = getCachedWindows();
            let openWindows = cWs.filter(function (obj) {
                return obj.dockIcon == cW.dockIcon;
            });
            if (openWindows.length == 0) {
                window.parent.document.getElementById(cW.dockIcon).classList.remove('li-on');
            }

            //Undraw the window
            window.parent.document.getElementById(windowID).remove();
        }

        function addData(newValue, datasetIndex) {
            let newData = CPUUsageChart.data.datasets[datasetIndex].data;
            if (newData.length >= 60) {
                newData = newData.slice(1, 60);
            }
            newData.push(newValue);
            CPUUsageChart.data.datasets[datasetIndex].data = newData;
            CPUUsageChart.update();
        }

        function loadCPUGraph() {
            CPUUsageChart = new Chart("CPUUsage", {
                type: "line",
                data: {
                    labels: xValues,
                    datasets: [
                        {
                            label: 'Uso de CPU',
                            fill: true,
                            lineTension: 0,
                            backgroundColor: "rgba(95,171,126,0.8)",
                            borderColor: "rgba(95,171,126,1)",
                            data: yValuesCPU
                        },
                        {
                            label: 'Uso de memoria',
                            fill: true,
                            lineTension: 0,
                            backgroundColor: "rgba(244,96,93,0.8)",
                            borderColor: "rgba(244,96,93,1)",
                            data: yValuesMemory,
                            hidden: true
                        },
                    ]
                },
                options: {
                    plugins: {
                        legend: {
                            display: true,
                            labels: {
                                color: '#ffffff'
                            }
                        }
                    },
                    dataset: {
                        label: { color: '#ffffff' }
                    },

                    scales: {
                        y: {
                            border: {
                                display: false
                            },
                            grid: {
                                color: getSetting(keySettings.fontColor),
                            },
                            ticks: {
                                color: getSetting(keySettings.fontColor),
                                font: {
                                    family: 'Varela Round',
                                    size: 9,
                                    style: 'normal'
                                }
                            }
                        },
                        x: {
                            border: {
                                display: false
                            },
                            grid: {
                                color: getSetting(keySettings.fontColor),
                            },
                            ticks: {
                                color: getSetting(keySettings.fontColor),
                                font: {
                                    family: 'Varela Round',
                                    size: 9,
                                    style: 'normal'
                                }
                            }
                        }
                    },

                    animation: {
                        duration: 0
                    },

                }
            });
        }

        function load() {
            windowTitle.innerHTML = document.title;
            backButton.style.display = "none";
            forwardButton.style.display = "none";
            refreshButton.title = "Refrescar tareas";
            stopButton.title = "Cerrar tarea";
            homeButton.style.display = "none";

            loadTasks();
            loadCPUGraph();
            setInterval(loadCPU, 1000);
            loadCPU();
            showWindow(parentWindow);
        }

        function back() {

        }

        function forward() {

        }

        function refresh() {
            loadTasks();
        }

        function stop() {
            let ids = document.querySelectorAll('.checkedApps:checked');
            for (let i = 0; i < ids.length; i++) {
                closeApp(ids[i].value);
            }
            loadTasks();
        }

        function home() {

        } */
    </script>
</body>

</html>